generator client {
  provider = "prisma-client"
  output   = "../src/lib/prisma/generated"
}

datasource db {
  provider = "postgresql"
}

/* ===== User =====*/
model User {
  id String @id @default(cuid(2))

  email    String @unique
  password String
  fullName String

  role UserRole @default(CUSTOMER)

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

enum UserRole {
  CUSTOMER
  ADMIN
}

/* ===== Pizza =====*/
model Pizza {
  id String @id @default(cuid(2))

  name    String  @unique @db.VarChar(50)
  slug    String
  InStock Boolean @default(true)

  ingredients PizzaIngredient[]
  toppings    PizzaTopping[]
  variants    PizzaVariant[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PizzaIngredient {
  pizzaId      String
  pizza        Pizza      @relation(fields: [pizzaId], references: [id])
  ingredientId String
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])

  isRemovable Boolean @default(false)

  @@id([pizzaId, ingredientId])
}

model PizzaTopping {
  pizzaId      String
  pizza        Pizza      @relation(fields: [pizzaId], references: [id])
  ingredientId String
  ingredient   Ingredient @relation(fields: [ingredientId], references: [id])

  @@id([pizzaId, ingredientId])
}

model Ingredient {
  id String @id @default(cuid(2))

  name     String  @unique @db.VarChar(30)
  price    Int
  imageUrn String? @unique

  pizzas   PizzaIngredient[]
  toppings PizzaTopping[]

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model PizzaVariant {
  id String @id @default(cuid(2))

  pizzaId String
  pizza   Pizza      @relation(fields: [pizzaId], references: [id])
  sizeId  String
  size    PizzaSize  @relation(fields: [sizeId], references: [name])
  crustId String
  crust   PizzaCrust @relation(fields: [crustId], references: [name])

  price    Int
  imageUrn String? @unique

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@unique([pizzaId, sizeId, crustId])
}

model PizzaSize {
  name  String @id
  value Int

  variants PizzaVariant[]
}

model PizzaCrust {
  name  String @id
  value String

  variants PizzaVariant[]
}
